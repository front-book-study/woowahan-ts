# 앰비언트 타입 활용하기

### 엠비언트 타입이란

`.d.ts` 확장자를 가진 파일에서는 타입 선언만 할 수 있다.

값을 포함하는 일반적인 선언과 구별하기 위해 .d.ts 확장자를 가진 파일에서 하는 타입선언을 앰비언트 타입 선언이라고 부른다.

앰비언트 타입 선언으로 값을 정의할 순 없지만, `declare`라는 키워드를 사용해 어딘가 자바스크립트 값이 존재한다는 사실을 선언할 수 있다.

## 활용

타입스크립트를 사용할 때 *.js 또는 *.ts 형식이 아닌 파일을 임포트할 때 종종 에러가 발생하는 것을 보게 된다.

예를 들어 .png 등 이미지 파일을 모듈로 임포트할 때, 자바스크립트 환경에서는 멀쩡히 동작하던 게 타입스크립트 환경에서는 에러가 발생하는 상황이 연출되곤 한다.

타입스크립트는 기본적으로 .ts 와 .js 파일만 이해하며 그 외에 다른 파일 형식은 인식하지 못한다. 따라서 알 지 못하는 파일 형식을 모듈로 가져오려 하면 에러가 발생한다. 

```tsx
declare module "*.png" {
  const src: string;
  export default src;
}
```

위처럼 declare 키워드는 이미 존재하지만 타입스크립트가 알지 못하는 부분을 컴퍼아리러에 ‘이러한 것이 존재해’ 라고 알려주는 역할을 한다.



### **자바스크립트로 작성된 라이브러리**

자바스크립트로 작성된 npm 라이브러리가 있다고 해보자

이 라이브러리는 자바스크립트로 구현되었기에 타입 선언이 존재하지 않는다. 

따라서, 타입스크립트에서 이 라이브러리를 사용할 수 있지만, 타입 선언이 없으므로 임포트한 모듈은 모두 any로 추론될 것이다.

이떄, 앰비언트 타입 선언을 사용할 수 있다.

### 타입스크립트로 작성된 라이브러리

타입스크립트로 작성된 라이브러리이리잘도 자바스크립트 파일과 `.d.ts` 파일로 배포되는 것이 일반적이다.

타입스크립트 파일을 직접 배포하여 라이브러리 사용자가 타입스크립트 파일을 컴파일할 때 라이브러리 코드 비교도 함께 컴파일하게 할 수도 있다. 그러나 컴파일 시간을 줄이기 위해 .d.ts파일을 tsconfig.json 파일을 delaration 설정으로 자동 .d.ts 파일을 생성하게 한다.

### 자바스크립트 어딘가에 전역 변수가 정의되어 있음을 타입스크립트에 알릴 때

직접 구현하지 않은 코드더라도, 자바스크립트 전역 변수 어딘가에 정의되어 있는것을 타입스크립트에 알릴 때 앰비언트 타입 선언을 사용

e.g. window

### 주의점

1. 타입스크립트로 만드는 라이브러리에는 불필요
    1. tsconfig.json의 설정으로 자동 생성해주기 떄문에 따로 작성 필요 x
2. 전역으로 타입을 정의하여 사용할 떄 주의할 점
    1. 서로 다른 라이브러리에서 동일한 이름의 앰비언트 타입 선언 시 충돌 가능성 있음

### 앰비언트 타입 선언 잘못 사용 시 문제점

`declare` 키워드로 .d.ts 파일이 아닌 .ts, .tsx 파일 어디서든 앰비언트 변수 선언을 할 수 있지만, `import` 없이도 어느 곳에 나 영향을 줄 수 있기 떄문에 .d.ts 확장자 파일 내에서 앰비언트 타입 선언을 하는 것을 권장 

### 앰비언트 타입 활용하기

1. **타입을 정의하여 임포트 없이 전역으로 공유**
2. **보편적으로 많이 사용하는 커스텀 유틸리티 타입 선언**
    
    ```tsx
    // src/index.d.ts
    type Optional<T extends object, K extends keyof T = keyof T> = Omit<T, K> &
      Partial<Pick<T, K>>;
    
    // src/components.ts
    type Props = { name: string; age: number; visible: boolean };
    type OptionalProps = Optional<Props>; // Expect: { name?: string; age?: number; visible?: boolean;
    ```
    
3. declare module 활용
4. declare namespace 활용
5. declare global 활용하기
    
    ```tsx
    declare global {
      interface Window {
        webkit?: {
          messageHandlers?: Record<
            string,
            {
              postMessage?: (parameter: string) => void;
            }
          >;
        };
      }
    }
    ```
    
    - WebView 환경(iOS)에서는 window.webkit이 존재함 ✅
    - 일반 브라우저 환경에서는 존재하지 않음 ❌
    - 타입이 webkit: { ... }으로 되어 있다면,
        
        TS는 window.webkit이 항상 존재한다고 “믿어버림”
        
        → 실제로 없는 환경에서 undefined 접근 오류 발생
        


## declare 와 번들러의 시너지

번들러 설정을 통한 inject

# 스크립트와 설정 파일 활용하기

### 실시간 타입 검사

```tsx
yarn tsc --noEmit --incremental -w
```

- noEmit: 자바스크립트로 된 출력 파일을 생성하지 않도록 설정
- incremental: 증분 컴파일을 활성화하여 컴파일 시간을 단축
- w: 파일 변경 사항 모니터링

<aside>

❓증분 컴파일

매번 모든 대상을 컴파일 하는 것이 아닌, 변경 사항이 있는 부분만 컴파일 ⇒ 컴파일 시간 단축

</aside>

### 타입 커버리지 확인

any를 사용하고 있는 변수 위치 표시

```tsx
npx type-coverage --detail
```

### 타입스크립트 컴파일 속도 높이기

tsconfig > incremental
